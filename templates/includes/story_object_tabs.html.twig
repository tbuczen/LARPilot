{# templates/includes/story_object_tabs.html.twig #}
{# Tab macro for story object with route-based navigation #}

{% macro tabs(currentTab, storyObject, storyObjectType, larp, mentionsCount, includeDecisionTree, applicantsCount, commentsCount, unresolvedCommentsCount) %}
    {% set includeDecisionTree = includeDecisionTree|default(false) %}
    {% set applicantsCount = applicantsCount|default(0) %}
    {% set commentsCount = commentsCount|default(0) %}
    {% set unresolvedCommentsCount = unresolvedCommentsCount|default(0) %}

    {% set baseRoute = 'backoffice_larp_story_' ~ storyObjectType ~ '_modify' %}
    {% set mentionsRoute = 'backoffice_larp_story_' ~ storyObjectType ~ '_mentions' %}
    {% set treeRoute = 'backoffice_larp_story_' ~ storyObjectType ~ '_tree' %}
    {% set applicantsRoute = 'backoffice_larp_story_' ~ storyObjectType ~ '_applicants' %}

    <ul class="nav nav-tabs nav-fill" role="tablist">
        {# Details Tab #}
        <li class="nav-item" role="presentation">
            <a class="nav-link {{ currentTab == 'details' ? 'active' : '' }}"
               href="{{ path(baseRoute, {larp: larp.id, (storyObjectType): storyObject.id}) }}">
                <i class="bi bi-pencil-square me-2"></i>{{ 'details'|trans }}
            </a>
        </li>

        {# Mentions Tab #}
        {% if mentionsCount != false %}
        <li class="nav-item" role="presentation">
            <a class="nav-link {{ currentTab == 'mentions' ? 'active' : '' }}"
               href="{{ path(mentionsRoute, {larp: larp.id, (storyObjectType): storyObject.id}) }}">
                <i class="bi bi-link-45deg me-2"></i>{{ 'story_object.mentions.title'|trans }}
                <span class="badge bg-secondary ms-1">{{ mentionsCount }}</span>
            </a>
        </li>
        {% endif %}

        {# Decision Tree Tab (only for Quest and Thread) #}
        {% if storyObjectType == 'quest' or storyObjectType == 'thread' %}
            <li class="nav-item" role="presentation">
                <a class="nav-link {{ currentTab == 'tree' ? 'active' : '' }}"
                   href="{{ path(treeRoute, {larp: larp.id, (storyObjectType): storyObject.id}) }}">
                    <i class="bi bi-diagram-3 me-2"></i>{{ 'larp.decision_tree'|trans }}
                </a>
            </li>
        {% endif %}

        {# Applicants Tab (only for Character) #}
        {% if storyObjectType == 'character' %}
            <li class="nav-item" role="presentation">
                <a class="nav-link {{ currentTab == 'applicants' ? 'active' : '' }}"
                   href="{{ path(applicantsRoute, {larp: larp.id, (storyObjectType): storyObject.id}) }}">
                    <i class="bi bi-people me-2"></i>{{ 'larp.character.applicants.title'|trans }}
                    <span class="badge bg-primary ms-1">{{ applicantsCount }}</span>
                </a>
            </li>
        {% endif %}

        {# Discussions Tab #}
        {% if storyObject.exists %}
        <li class="nav-item" role="presentation">
            <a class="nav-link {{ currentTab == 'discussions' ? 'active' : '' }}"
               href="{{ path('backoffice_larp_story_comment_discussions', {larp: larp.id, storyObject: storyObject.id}) }}">
                <i class="bi bi-chat-dots me-2"></i>{{ 'comment.discussions'|trans }}
                <span class="badge bg-warning ms-1">{{ unresolvedCommentsCount }}</span>
                <span class="badge bg-secondary ms-1">{{ commentsCount }}</span>
            </a>
        </li>
        {% endif %}
    </ul>
{% endmacro %}
