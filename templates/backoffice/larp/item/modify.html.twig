{% extends 'backoffice/larp/base.html.twig' %}
{% import 'macros/ui_components.html.twig' as ui %}
{% import 'includes/story_object_tabs.html.twig' as tabs_macro %}

{% block larp_content %}
    {% if item.id %}
        {% include 'includes/story_object_header.html.twig' with {
            storyObject: item,
            storyObjectType: 'larp.item.singular',
            mentionsCount: mentions|length
        } %}
    {% endif %}

    {% set detailsContent %}
        <div class="tab-pane border border-top-0 p-3">
            <div class="card-body">
                {{ form_start(form) }}

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            {{ form_label(form.title, null, {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(form.title, {'attr': {'class': 'form-control'}}) }}
                            {{ form_errors(form.title) }}
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="mb-3">
                            {{ form_label(form.quantity, null, {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(form.quantity, {'attr': {'class': 'form-control', 'min': '0'}}) }}
                            {{ form_errors(form.quantity) }}
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    {{ form_label(form.description, null, {'label_attr': {'class': 'form-label'}}) }}
                    {{ form_widget(form.description, {'attr': {'class': 'form-control', 'rows': '4'}}) }}
                    {{ form_errors(form.description) }}
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            {{ form_label(form.cost, null, {'label_attr': {'class': 'form-label'}}) }}
                            {{ form_widget(form.cost, {'attr': {'class': 'form-control', 'min': '0', 'step': '0.01'}}) }}
                            {{ form_errors(form.cost) }}
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="mb-3">
                            <div class="row">
                                <div class="col-6">
                                    <div class="form-check">
                                        {{ form_widget(form.isCrafted, {'attr': {'class': 'form-check-input'}}) }}
                                        {{ form_label(form.isCrafted, null, {'label_attr': {'class': 'form-check-label'}}) }}
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        {{ form_widget(form.isPurchased, {'attr': {'class': 'form-check-input'}}) }}
                                        {{ form_label(form.isPurchased, null, {'label_attr': {'class': 'form-check-label'}}) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {{ form_rest(form) }}

                {{ ui.form_actions(
                    item is defined and item.id ? 'save' : 'create',
                    'bi-check-circle',
                    path('backoffice_larp_story_item_list', { larp: larp.id })
                ) }}

                {{ form_end(form) }}
            </div>
        </div>

        {% if item.id %}
            {# Relations #}
            <div class="card mb-3 shadow-sm">
                <div
                        class="card-header d-flex justify-content-between align-items-center"
                        data-bs-toggle="collapse"
                        data-bs-target="#relationsCollapse"
                        role="button"
                        aria-expanded="false"
                        aria-controls="relationsCollapse"
                >
                <span class="fw-bold">
                    {{ 'larp.relation.list'|trans }}
                </span>
                    <i class="bi bi-chevron-down"></i>
                </div>

                <div id="relationsCollapse" class="collapse">
                    <div class="card-body">
                        {{ component('StoryObjectRelationListForm', {
                            storyObject: item,
                        }) }}
                    </div>
                </div>
            </div>

            {# References #}
            <div class="card mb-3 shadow-sm">
                <div
                        class="card-header d-flex justify-content-between align-items-center"
                        data-bs-toggle="collapse"
                        data-bs-target="#referencesCollapse"
                        role="button"
                        aria-expanded="false"
                        aria-controls="referencesCollapse"
                >
                <span class="fw-bold">
                    {{ 'larp.reference.list'|trans }}
                </span>
                    <i class="bi bi-chevron-down"></i>
                </div>

                <div id="referencesCollapse" class="collapse">
                    <div class="card-body">
                        {{ component('StoryObjectReferencesListForm', {
                            storyObject: item,
                        }) }}
                    </div>
                </div>
            </div>

            {# Version History #}
            <div class="card mb-3 shadow-sm">
                <div
                        class="card-header d-flex justify-content-between align-items-center"
                        data-bs-toggle="collapse"
                        data-bs-target="#versionHistoryCollapse"
                        role="button"
                        aria-expanded="false"
                        aria-controls="versionHistoryCollapse"
                >
                <span class="fw-bold">
                    {{ 'larp.version_history'|trans }}
                </span>
                    <i class="bi bi-chevron-down"></i>
                </div>

                <div id="versionHistoryCollapse" class="collapse">
                    <div class="card-body">
                        {{ component('StoryObjectVersionHistory', {
                            storyObject: item,
                            showChangelogLinks: true
                        }) }}
                    </div>
                </div>
            </div>
        {% endif %}
    {% endset %}

    {% if item.id %}
        {# Tabs navigation #}
        {{ tabs_macro.tabs('details', item, 'item', larp, mentions|length, false) }}

        {{ detailsContent|raw }}
    {% else %}
        {{ detailsContent|raw }}
    {% endif %}

{% endblock %}

{% block title %}{{ larp.title }} - {{ item.title ?? 'new'|trans }}{% endblock %}
