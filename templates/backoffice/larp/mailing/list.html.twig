{% extends 'backoffice/larp/base.html.twig' %}
{% import 'macros/ui_components.html.twig' as ui %}

{% block larp_title %}{{ 'mailing.templates.title'|trans }} - {{ larp.title }}{% endblock %}

{% block larp_content %}
    <div class="card mt-4">
        {% set subtitle %}
            <p class="text-muted mb-0">{{ 'mailing.templates.subtitle'|trans }}</p>
        {% endset %}
        <div class="card-header">
            <div class="d-flex flex-column">
                <h2 class="mb-1">{{ 'mailing.templates.title'|trans }}</h2>
                {{ subtitle|raw }}
            </div>
        </div>
        <div class="card-body p-0">
            {% include 'includes/filter_form.html.twig' with { form: filterForm, larp: larp } %}

            {% if templates is not empty %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>{{ 'name'|trans }}</th>
                            <th>{{ 'mail_template.type'|trans({}, 'forms') }}</th>
                            <th>{{ 'description'|trans }}</th>
                            <th>{{ 'mail_template.available_placeholders'|trans }}</th>
                            <th class="text-center">{{ 'status'|trans }}</th>
                            <th>{{ 'actions'|trans }}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for template in templates %}
                            {% set definition = definitions[template.type.value] ?? null %}
                            <tr>
                                <td>
                                    <a href="{{ path('backoffice_larp_mailing_template_edit', { larp: larp.id, mailTemplate: template.id }) }}"
                                       class="fw-semibold">
                                        {{ template.name }}
                                    </a>
                                    {% if definition and not definition.mandatory %}
                                        <span class="badge bg-secondary ms-1">{{ 'mail_template.optional'|trans }}</span>
                                    {% endif %}
                                    {% if template.type.belongsToFinanceContext %}
                                        <span class="badge bg-warning  ms-1">{{ 'mail_template.finance'|trans }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge  ">{{ template.type.label }}</span>
                                </td>
                                <td class="text-muted">
                                    {{ definition ? definition.description : '-' }}
                                </td>
                                <td>
                                    {% if template.availablePlaceholders is not empty %}
                                        <div class="d-flex flex-wrap gap-1">
                                            {% for placeholder in template.availablePlaceholders %}
                                                <span class="badge bg-outline border border-primary text-primary">{{ '{{ ' ~ placeholder ~ ' }}' }}</span>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td class="text-center">
                                    {% if template.enabled %}
                                        <span class="badge bg-success">{{ 'enabled'|trans }}</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ 'disabled'|trans }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ ui.edit_button(path('backoffice_larp_mailing_template_edit', { larp: larp.id, mailTemplate: template.id }), 'edit', 'sm', true) }}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                {{ ui.empty_state('mailing.templates.empty', 'bi-envelope-open') }}
            {% endif %}
        </div>
    </div>
{% endblock %}
