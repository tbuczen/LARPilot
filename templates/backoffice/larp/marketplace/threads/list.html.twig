{% extends 'backoffice/larp/marketplace/_base.html.twig' %}
{% import 'macros/ui_components.html.twig' as ui %}

{% block larp_title %}{{ 'marketplace.threads_list'|trans }} - {{ larp.title }}{% endblock %}

{% set active_tab = 'threads' %}

{% block marketplace_content %}
    {% include 'includes/filter_form.html.twig' with { form: filterForm } %}

    {% if threads is not empty %}
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>{{ 'title'|trans }}</th>
                        <th>{{ 'description'|trans }}</th>
                        <th>{{ 'tags'|trans }}</th>
                        <th>{{ 'marketplace.involved'|trans }}</th>
                        <th>{{ 'actions'|trans }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for thread in threads %}
                        <tr>
                            <td>
                                <a href="{{ path('backoffice_larp_story_thread_modify', {
                                    larp: larp.id, thread: thread.id
                                }) }}">
                                    {{ thread.title }}
                                </a>
                            </td>
                            <td>{{ thread.description|truncate_words(10) }}</td>
                            <td>
                                {% for tag in thread.tags %}
                                    <span class="badge bg-info">{{ tag.title }}</span>
                                {% endfor %}
                            </td>
                            <td>
                                {% if thread.involvedCharacters|length > 0 %}
                                    <strong>{{ 'characters'|trans }}:</strong>
                                    {% for char in thread.involvedCharacters|slice(0, 3) %}
                                        {{ char.title }}{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                    {% if thread.involvedCharacters|length > 3 %}
                                        <span class="text-muted">+{{ thread.involvedCharacters|length - 3 }} more</span>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">{{ 'marketplace.no_characters'|trans }}</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{{ path('backoffice_larp_story_thread_modify', {
                                    larp: larp.id, thread: thread.id
                                }) }}" class="btn btn-sm btn-success">
                                    <i class="bi bi-pencil me-1"></i>{{ 'edit'|trans }}
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% include 'includes/pagination.html.twig' with { pagination: threads } %}
    {% else %}
        {{ ui.empty_state('empty_list', 'bi-bezier2') }}
    {% endif %}
{% endblock %}
