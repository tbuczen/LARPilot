{% extends 'backoffice/larp/base.html.twig' %}

{% block title %}{{ 'settings'|trans }} - {{ larp.title }}{% endblock %}

{% block larp_content %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">{{ 'dashboard'|trans }}</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">{{ larp.description|raw }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Information Row -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'event.status'|trans }}</h6>
                    <span class="badge badge-{{ larp.status.value == 'draft' ? 'secondary' : (larp.status.value == 'active' ? 'success' : 'primary') }} fs-6">
                        {{ larp.status.value|upper }}
                    </span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'event.days_until'|trans }}</h6>
                    <h4 class="text-{{ dashboard.timing.daysUntilEvent < 0 ? 'danger' : (dashboard.timing.daysUntilEvent < 7 ? 'warning' : 'success') }}">
                        {% if dashboard.timing.daysUntilEvent is not null %}
                            {{ dashboard.timing.daysUntilEvent < 0 ? ('event.passed'|trans) : dashboard.timing.daysUntilEvent ~ ' ' ~ 'days'|trans }}
                        {% else %}
                            {{ 'not_set'|trans }}
                        {% endif %}
                    </h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'event.duration'|trans }}</h6>
                    <h4 class="text-info">
                        {% if dashboard.timing.duration is not null %}
                            {{ dashboard.timing.duration }} {{ dashboard.timing.duration != 1 ? 'days'|trans : 'day'|trans }}
                        {% else %}
                            {{ 'not_set'|trans }}
                        {% endif %}
                    </h4>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'location'|trans }}</h6>
                    {% if larp.location %}
                        <p class="mb-0">
                            <a href="{{ path('public_location_details', { slug: larp.location.slug }) }}" target="_blank" rel="noopener">
                                {{ larp.location }}
                            </a>
                        </p>
                    {% else %}
                        <p class="mb-0">{{ 'not_set'|trans }}</p>
                    {% endif %}                </div>
            </div>
        </div>
    </div>

    <!-- Participation Statistics Row -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'applications.total'|trans }}</h6>
                    <h3 class="text-primary">{{ dashboard.applications.total }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'applications.pending'|trans }}</h6>
                    <h3 class="text-warning">{{ dashboard.applications.pending }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'participants.confirmed'|trans }}</h6>
                    <h3 class="text-success">{{ dashboard.participants.total }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'participants.max_character_choices'|trans }}</h6>
                    <h3 class="text-info">{{ dashboard.participants.maxChoices }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Character & Gameplay Statistics Row -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'characters.total'|trans }}</h6>
                    <h3 class="text-primary">{{ dashboard.characters.total }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'characters.assigned'|trans }}</h6>
                    <h3 class="text-success">{{ dashboard.characters.assigned }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'characters.available'|trans }}</h6>
                    <h3 class="text-warning">{{ dashboard.characters.unassigned }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'factions.active'|trans }}</h6>
                    <h3 class="text-info">{{ dashboard.factions.total }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Statistics Row -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'skills.available'|trans }}</h6>
                    <h3 class="text-primary">{{ dashboard.skills.total }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'events.sub'|trans }}</h6>
                    <h3 class="text-success">{{ dashboard.events.total }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'integrations.count'|trans }}</h6>
                    <h3 class="text-info">{{ dashboard.integrations.total }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="card-title">{{ 'event.dates'|trans }}</h6>
                    <small class="text-muted">
                        {% if larp.startDate %}
                            {{ larp.startDate|date('M d, Y') }}
                            {% if larp.endDate and larp.endDate != larp.startDate %}
                                - {{ larp.endDate|date('M d, Y') }}
                            {% endif %}
                        {% else %}
                            {{ 'not_set'|trans }}
                        {% endif %}
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Faction Distribution -->
    {% if dashboard.factions.stats|length > 0 %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">{{ 'factions.distribution'|trans }}</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for faction in dashboard.factions.stats %}
                        <div class="col-md-4 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <span><a href="{{ path('backoffice_larp_story_faction_modify', {'larp': larp.id, 'faction' : faction.id}) }}">{{ faction.title }}</a></span>
                                <span class="badge badge-primary">{{ faction.participants }} {{ 'participants.list'|trans }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h6 class="card-title mb-0">{{ 'quick_actions'|trans }}</h6>
                </div>
                <div class="card-body">
                    <div class="btn-group" role="group">
                        {% if dashboard.applications.pending > 0 %}
                        <a href="{{ path('backoffice_larp_applications_list', {'larp': larp.id}) }}" class="btn btn-warning">
                            {{ 'applications.review'|trans }} ({{ dashboard.applications.pending }})
                        </a>
                        {% endif %}
                        {% if dashboard.characters.unassigned > 0 %}
                        <a href="{{ path('backoffice_larp_applications_match', {'larp': larp.id}) }}" class="btn btn-info">
                            {{ 'characters.assign'|trans }} ({{ dashboard.characters.unassigned }})
                        </a>
                        {% endif %}
                        <a href="{{ path('backoffice_larp_participant_list', {'larp': larp.id}) }}" class="btn btn-primary">{{ 'participants.manage'|trans }}</a>
{#                        <a href="#" class="btn btn-success">{{ 'send_announcement'|trans }}</a>#}
{#                        <a href="#" class="btn btn-outline-secondary">{{ 'generate_reports'|trans }}</a>#}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}