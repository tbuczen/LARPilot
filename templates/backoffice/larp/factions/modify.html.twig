{% extends 'backoffice/larp/base.html.twig' %}
{% import 'macros/ui_components.html.twig' as ui %}
{% import 'includes/story_object_tabs.html.twig' as tabs_macro %}

{% block larp_content %}
    {# Header showing story object type and title (only for existing objects) #}
    {% if faction.id %}
        {% include 'includes/story_object_header.html.twig' with {
            storyObject: faction,
            storyObjectType: 'faction',
            mentionsCount: mentions|length
        } %}
    {% endif %}

    {% set detailsContent %}
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">{{ 'faction'|trans }}</h5>
            </div>
            <div class="card-body">
                {{ form_start(form) }}
                {{ form_widget(form) }}

                {{ ui.form_actions(
                    faction is defined and faction.id ? 'save' : 'create',
                    'bi-check-circle',
                    path('backoffice_larp_story_faction_list', { larp: larp.id })
                ) }}
                {{ form_end(form) }}
            </div>
        </div>

        {% if faction.id and faction.members is not empty %}
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">{{ 'larp.character.list'|trans }}</h5>
                </div>
                <div class="card-body p-0">
                    <table class="table table-striped table-hover mb-0">
                        <thead class="table-light">
                        <tr>
                            <th>{{ 'name'|trans }}</th>
                            <th>{{ 'gender.singular'|trans }}</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for character in faction.members %}
                            <tr>
                                <td>
                                    <a href="{{ path('backoffice_larp_story_character_modify', { larp: larp.id, character: character.id }) }}" class="text-decoration-none">
                                        {{ character.getTitle() }}
                                    </a>
                                </td>
                                <td>{{ character.getGender().value ?? '-' }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endif %}
    {% endset %}

    {% if faction.id %}
        {# Tabs navigation #}
        {{ tabs_macro.tabs('details', faction, 'faction', larp, mentions|length, false) }}

        {{ detailsContent|raw }}
    {% else %}
        {{ detailsContent|raw }}
    {% endif %}

{% endblock %}

{% block title %}{{ 'faction'|trans }} - {{ faction.getTitle() ?? 'new'|trans }}{% endblock %}
