{% extends 'public/base.html.twig' %}

{% block title %}{{ 'larp.list'|trans }}{% endblock %}

{% block body %}
{% include 'includes/page_header.html.twig' with {
    title: 'larp.list'|trans,
    subtitle: 'Discover upcoming LARP events',
    icon: 'bi bi-calendar-event'
} %}

<div class="container">
    <div class="row">
        <div class="col-12">
            {% if filterForm is defined %}
                {% include 'includes/filter_form.html.twig' with { form: filterForm } %}
            {% endif %}

            <div class="row">
                {% for larp in larps %}
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <a href="{{ path('public_larp_details', {'slug': larp.slug}) }}" class="text-decoration-none text-dark">
                                        {{ larp.title }}
                                        <i class="bi bi-box-arrow-up-right ms-1 small text-muted"></i>
                                    </a>
                                </h5>
                                <p class="card-text">{{ larp.description|truncate_words(15) }}</p>

                                <div class="mb-2">
                                    <strong>Status:</strong>
                                    <span class="badge bg-{{ larp.status.value == 'PUBLISHED' ? 'primary' : (larp.status.value == 'CONFIRMED' ? 'success' : 'secondary') }}">
                                        {{ larp.status.value|title }}
                                    </span>
                                </div>

                                {% if larp.setting %}
                                    <div class="mb-2">
                                        <strong>Setting:</strong>
                                        <span class="badge bg-info">{{ larp.setting.label }}</span>
                                    </div>
                                {% endif %}

                                {% if larp.type %}
                                    <div class="mb-2">
                                        <strong>Type:</strong>
                                        <span class="badge bg-warning">{{ larp.type.label }}</span>
                                    </div>
                                {% endif %}

                                {% if larp.characterSystem %}
                                    <div class="mb-2">
                                        <strong>Characters:</strong>
                                        <span class="badge bg-dark">{{ larp.characterSystem.label }}</span>
                                    </div>
                                {% endif %}

                                <div class="mb-2">
                                    <strong>Date:</strong> {{ larp.startDate|date('Y-m-d') }} - {{ larp.endDate|date('Y-m-d') }}
                                </div>

                                <div class="mb-2">
                                    <strong>Duration:</strong> {{ larp.duration }} day{{ larp.duration > 1 ? 's' : '' }}
                                </div>

                                {% if larp.location %}
                                    <div class="mb-2">
                                        <strong>Location:</strong>
                                        <a href="{{ path('public_location_details', {'slug': larp.location.slug}) }}" class="text-decoration-none">
                                            {{ larp.location.title }}
                                        </a>
                                        <br><small class="text-muted">{{ larp.location.city }}{% if larp.location.country %}, {{ larp.location.country }}{% endif %}</small>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="card-footer">
                                <a href="{{ path('public_larp_details', {'slug': larp.slug}) }}" class="btn btn-primary">
                                    {{ 'show_details'|trans }}
                                </a>
                                {% if app.user %}
                                    {% set isOrganizer = false %}
                                    {% for participant in larp.participants %}
                                        {% if participant.user.id == app.user.id and participant.isOrganizer %}
                                            {% set isOrganizer = true %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if isOrganizer %}
                                        <a href="{{ path('backoffice_larp_dashboard', {'larp': larp.id}) }}" class="btn btn-secondary">
                                            <i class="bi bi-gear me-1"></i>{{ 'manage'|trans }}
                                        </a>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> No LARPs found matching your criteria.
                        </div>
                    </div>
                {% endfor %}
            </div>

            {% include 'includes/pagination.html.twig' with { pagination: larps } %}
        </div>
    </div>
</div>

{% endblock %}