parameters:
    google_recaptcha_site_key: '%env(GOOGLE_RECAPTCHA_SITE_KEY)%'
    google_api_key: '%env(GOOGLE_API_KEY)%'
    google_maps_api_key: '%env(GOOGLE_MAPS_API_KEY)%'
    google_app_id: '%env(GOOGLE_APP_ID)%'
    oauth_google_client_id: '%env(OAUTH_GOOGLE_CLIENT_ID)%'
    maps_directory: '%kernel.project_dir%/public/uploads/maps'
    github.token: '%env(GITHUB_TOKEN)%'
    github.repo: '%env(GITHUB_REPO)%'
    github.discussion_category_id: '%env(GITHUB_DISCUSSION_CATEGORY_ID)%'
    # StoryAI configuration
    openai.api_key: '%env(OPENAI_API_KEY)%'
    openai.embedding_model: '%env(OPENAI_EMBEDDING_MODEL)%'
    openai.completion_model: '%env(OPENAI_COMPLETION_MODEL)%'
    # Vector Store configuration (CQRS - external vector database)
    vector_store.dsn: '%env(default::VECTOR_STORE_DSN)%'
services:
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.
        bind:
            $defaultLocale: 'en'
            $googleClientId: '%oauth_google_client_id%'
            $googleClientSecret: '%env(OAUTH_GOOGLE_CLIENT_SECRET)%'
            $googleServiceEmail: '%env(GOOGLE_SERVICE_EMAIL)%'
            $serviceAccountJsonPath: '%env(resolve:GOOGLE_SERVICE_ACCOUNT_JSON)%'
            $githubToken: '%github.token%'
            $githubRepo: '%github.repo%'
            $githubDiscussionCategoryId: '%github.discussion_category_id%'
            $recaptchaSecretKey: '%env(GOOGLE_RECAPTCHA_SECRET)%'

    _instanceof:
        App\Domain\Integrations\Service\IntegrationServiceInterface:
            tags: [ 'app.integration' ]
        Symfony\Component\Security\Core\Authorization\Voter\VoterInterface:
          tags: [ 'security.voter' ]

    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Domain/*/Entity'
            - '../src/Kernel.php'

    App\Domain\Core\Service\Helper\Logger:
        public: true

    App\Twig\:
        exclude:
            - '../src/Twig/Components/'
        resource: '../src/Twig/'
        tags: [ 'twig.extension' ]

    App\Domain\Integrations\Service\Sharing\DriveSharingServiceProvider:
        arguments:
            $services:
                integration_google_drive: '@App\Domain\Integrations\Service\Sharing\GoogleDriveSharingService'

    App\Domain\Integrations\Service\IntegrationServiceProvider:
        arguments:
            $integrationServices: !tagged_iterator app.integration

    ShipMonk\DoctrineEntityPreloader\EntityPreloader: ~

    # StoryAI OpenAI Provider
    App\Domain\StoryAI\Service\Provider\OpenAIProvider:
        arguments:
            $apiKey: '%openai.api_key%'
            $embeddingModel: '%openai.embedding_model%'
            $completionModel: '%openai.completion_model%'

    # Register OpenAIProvider for both interfaces
    App\Domain\StoryAI\Service\Provider\EmbeddingProviderInterface:
        alias: App\Domain\StoryAI\Service\Provider\OpenAIProvider

    App\Domain\StoryAI\Service\Provider\LLMProviderInterface:
        alias: App\Domain\StoryAI\Service\Provider\OpenAIProvider

    # Vector Store (CQRS - external vector database for AI embeddings)
    App\Domain\StoryAI\Service\VectorStore\VectorStoreFactory:
        arguments:
            $httpClient: '@http_client'

    App\Domain\StoryAI\Service\VectorStore\VectorStoreInterface:
        factory: ['@App\Domain\StoryAI\Service\VectorStore\VectorStoreFactory', 'create']
        arguments:
            $dsn: '%vector_store.dsn%'